[size=11][align=right][img]https://github.com/Ander73/Store/raw/master/poetry.png[/img]"Пароли, пароли, пароли…"[/align][/size][hr]
[size=18][b][align=center]*** Change Password ***[/align][/b][/size]
[hr]
[img=right]https://github.com/Ander73/Store/raw/master/ChangePassword/img/title.gif[/img]
[br]
[color=blue][b]Назначение проекта: [/b][/color][list]Предоставление доступа к локальной системе Windows путём смены пароля и статуса локальных учётных записей, и/или подмены системных утилит, вызываемых нажатием "горячих клавиш" на экране входа в систему.[/list]
[br]
[color=blue][b]Представляет собой: [/b][/color][list]Командный бат-файл.[/list]
[br]
[color=blue][b]Область применения:[/b][/color]
[list][*]Операционная система: MS Windows XP/7/8.1/10
[*]Разрядность: x86/x64
[*]Язык: ~любой (тестировалось на европейских языках)
[/list]
[br]
[spoiler=Способ применения]
Загружаемся из любой WinPE. Запускаем бат-ник, который просканирует диски в поисках Windows (если дисков с Windows не один, то предложит ввести нужный). Далее будет предложено:
[list=1][*]Установить обработчик учётных записей
[list]
Сделает твик реестра (куст System) целевой Windows и добавит бат-ник в корень найденного/выбранного системного диска. После чего можно перезагрузиться в целевую систему. На этапе загрузки (до появления экрана входа в систему) откроется консольное окно со списком пользователей. Ввести номер нужного пользователя и:
[list][*]Сменить ему пароль/Конвертировать «Учётную запись Microsoft» в локальную;
[*]Активировать/Деактивировать;
[*]Сделать локальным Администратором.
[/list]
По завершении работы бат-ник удалит из реестра свой запуск и самого себя с системного диска.
[br]
Существует возможность автоматического создания локального Администратора, если номером пользователя ввести [b]544[/b].
Создаётся пользователь: [b]aaddmm66[/b] (если не введено другое имя) с паролем: [b]AdminPass666[/b]
[hr]
Если обработчик учётных записей уже был установлен, то повторный выбор этого пункта предложит:
[list][*]Переустановить обработчик учётных записей;
[*]Удалить обработчик учётных записей (вернёт состояние реестра целевой Windows в исходное и удалит бат-ник из корня найденного/выбранного системного диска);
[*]Оставить как есть.
[/list]
[/list]
[br]
[*=3]Выполнить подмену системных утилит
[list]
Файлы целевой Windows [i]%SystemRoot%\System32\Utilman.exe[/i], [i]magnify.exe[/i] и [i]sethc.exe[/i] будут заменены на [i]cmd.exe[/i] (а исходные файлы переименованы в [i]*.exe.bak[/i]). Дополнительно сам бат-ник будет скопирован в [i]%SystemRoot%\System32\112.cmd[/i]. На этапе входа в систему (окно со списком аккаунтов и ввода пароля) нажать одно из сочетание клавиш: [b]Win_U[/b], или [b]Win_+[/b], или нажать клавишу [b]Shift[/b] пять раз. Откроется консольное окно, где можно вводить команды ОС или запустить с флешки любимое приложение.
Если в окне консоли ввести [b]112[/b], то запустится обработчик учётных записей (см п.1). Для применения сделанных изменений потребуется перезагрузка.
[br]
По завершении работы бат-ник не удаляется и может быть запускаем до тех, пока существует подмена системных утилит.
[br]
[color=red][b]Внимание![/b][/color] В WindowsXP работает только комбинация "нажать Shift пять раз"
[hr]
Если подмена уже выполнена, то появится пункт меню, позволяющий отменить сделанную подмену (соответствующие *.bak-файлы будут переименованы в исходные, а 112.cmd удалён).
[/list]
[br]
[*=5]Сохранить/Восстановить/Удалить копию ветки реестра SAM
[list]
Позволяет создать копию ветки реестра SAM целевой Windows и, в случае неудачи при операциях смены паролей/статусов учётных записей, откатить сделанные изменения, путём восстановления сохранённой копии. Если же всё прошло удачно, то сохранённую копию можно просто удалить. При восстановлении ветки реестра SAM копия также удаляется.
[br]
Как реализовано: в [i]%SystemRoot%\System32\config[/i] целевой Windows создаётся папка [i]~SAM[/i] куда копируется ветка реестра.
[/list]
[/list][br]
[spoiler=*** Важно! ***]
[color=red][b]Важно![/b][/color] Если компьютер вошёл в "круговую перезагрузку", выполнить следующее: загрузиться в WinPE, выполнить бат-ник, выбрать пункт "Установить обработчик учётных записей" и затем выбрать "Удалить и выйти" (см. второй [i]screenshot[/i]).
[br]
[color=red][b]Важно![/b][/color] Во избежание "эффекта FastBoot" (ошибка "Реестр заблокирован!", диск целевой Windows монтируется не как С:, а другим диском) применять следующий порядок загрузки: загрузиться в целевую Windows, затем выполнить перезагрузку и загрузить WinPE (не грузить сразу WinPE из состояния выключенного ПК).
[br]
[color=red][b]Важно![/b][/color] Убедитесь, что целевая Windows не находится в процессе установки обновлений (при перезагрузке не должно быть сообщений об установке). В противном случае, произведите необходимое количество перезагрузок целевой Windows до полного завершения установки обновлений.
[/spoiler]
[spoiler=Screenshots][align=center]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/01.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/02.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/03.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/04.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/05.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/06.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/07.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/10.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/11.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/12.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/13.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/14.gif[/th]
[/align][/spoiler]
[spoiler=Для продвинутых пользователей]
[list][*]если в строке ввода номера пользователя ввести [b]cmd[/b], то откроется доп.консоль, куда можно вводить команды ОС (или, например, запустить с флешки любимое приложение).
[*]если в строке ввода номера пользователя ввести [b]repl[/b], то будет произведена подмена системных файлов (см. п.3 в "Способе применения").
[/list]
[/spoiler]
[/spoiler]
[spoiler=Дополнительная информация]
[list][*]Проверена работоспособность на русской, английской, французской, польской Windows.
[*]Интерфейс программы переведён на два языка: русский и английский. Русский язык выбирается при работе в русской Windows. Во всех остальных случаях интерфейс будет по-английски.
Желающие добавить переводы на другие языки - милости просим!
[br]
[*][color=blue]Примечание к интерфейсу:[/color] простое (без ввода цифр) нажатие клавиши "Enter" равнозначно выбору пункта "0".
[*][color=blue]Примечание к имени файла:[/color] переименовывать бат-ник нежелательно; придерживаться правила: только латинские буквы, без пробелов и спец.символов; имя [b]112.cmd[/b] является зарезервированным.
[/spoiler]
[spoiler=ЧаВо]
[list][*][b]В:[/b] Как "сбросить пароль", чтобы входить в систему без ввода пароля?
[*][b]О:[/b] При вводе пароля просто нажать Enter (и затем ещё раз, при подтверждении).[/list]
[hr]
[list][*][b]В:[/b] Почему нет опции "сброса пароля"? Почему такой сложный пароль у создаваемого локального Администратора?
[*][b]О:[/b] На целевой Windows может быть настроена [url=https://technet.microsoft.com/ru-ru/library/mt634223%28v=vs.85%29.aspx]Политика паролей[/url], которая может требовать, чтобы пароль состоял, как минимум, из больших и маленьких букв, и цифр (более подробно см. по ссылке пункт требований к сложности пароля).[/list]
[hr]
[list][*][b]В:[/b] Как сменить пароль учётной записи пользователя домена?
[*][b]О:[/b] Никак. Сменить пароль можно только у локальной учётной записи (см. ниже рекомендации для «Учётной записи Microsoft», второй способ).[/list]
[hr]
[list][*]Если целевая Windows настроена на использование «Учётной записи Microsoft», то существует два способа решения. Первый - конвертировать «Учётную запись Microsoft» в локальную учётную запись (пароль при этом остаётся и может быть, в дальнейшем, сброшен/изменён по общим правилам). Это будет предложено в обработчике учётных записей вместо пункта "Смена пароля". Второй:
[list=1][*]Активировать локального Администратора или создать его автоматически;
[*]Сменить/сбросить, если необходимо, пароль активированного/созданного локального Администратора;
[*]Деактивировать, если необходимо, учётную запись Microsoft;
[*]Войти в систему под активированным/созданным локальным Администратором.[/list][/list]
[hr]
[list][*][b]В:[/b] Будет ли работать бат-ник в установленной системе, а не WinPE? Как работать с Windows, установленной в VHD?
[*][b]О:[/b] В установленной системе бат-ник работать будет, но необходимо запускать его от имени Администратора. Для работы с Windows, установленной в VHD, необходимо смонтировать VHD как локальный диск в оснастке «Управление дисками» (diskmgmt.msc) с разрешением записи и затем запустить бат-ник от имени Администратора.
[/list]
[/spoiler]
[spoiler=Благодарность]
[b]Joker-2013[/b], как инициатору проекта и активному участнику
[b]korsak7, nikzzzz[/b], за тестирование и дельные советы
[/spoiler]
[align=center][url=https://github.com/Ander73/Store/raw/master/ChangePassword/chpwd.7z]Загрузить Change Password [img]https://github.com/Ander73/Store/raw/master/download.png[/img][/url][/align]