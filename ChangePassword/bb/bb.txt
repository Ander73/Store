[size=11][align=right][img]https://github.com/Ander73/Store/raw/master/poetry.png[/img]"Пароли, пароли, пароли…"[/align][/size][hr]
[size=18][b][align=center]*** Change Password ***[/align][/b][/size]
[hr]
[img=right]https://github.com/Ander73/Store/raw/master/ChangePassword/img/title.gif[/img]
[br]
[color=blue][b]Назначение проекта: [/b][/color][list]Предоставление доступа к локальной системе Windows путём смены пароля и статуса локальных учётных записей, и/или подмены системных утилит, вызываемых нажатием "горячих клавиш" на экране входа в систему.[/list]
[br]
[color=blue][b]Представляет собой: [/b][/color][list]Командный бат-файл.[/list]
[br]
[color=blue][b]Способ применения: [/b][/color][list]
Загружаемся из любой WinPE. Запускаем бат-ник, который просканирует диски в поисках Windows (если дисков с Windows не один, то предложит ввести нужный). Далее будет предложено:
[list=1][*]Установить обработчик паролей
[list]
Сделает твик реестра (куст System) целевой Windows и добавит бат-ник в корень найденного/выбранного системного диска. После чего можно перезагрузиться в целевую систему. На этапе загрузки (до появления экрана входа в систему) откроется консольное окно со списком пользователей. Ввести номер нужного пользователя и:
[list][*]Сменить ему пароль;
[*]Активировать/Деактивировать;
[*]Сделать локальным Администратором.
[/list]
По завершении работы бат-ник удалит из реестра свой запуск и самого себя с системного диска.
[br]
Существует возможность автоматического создания локального Администратора, если номером пользователя ввести [b]544[/b].
Создаётся пользователь: [b]aaddmm66[/b] (если не введено другое имя) с паролем: [b]AdminPass666[/b]
[hr]
Если обработчик паролей уже был установлен, то повторный выбор этого пункта предложит:
[list][*]Переустановить обработчик паролей;
[*]Удалить обработчик паролей (вернёт состояние реестра целевой Windows в исходное и удалит бат-ник из корня найденного/выбранного системного диска);
[*]Оставить как есть.
[/list]
[/list]
[br]
[*]Выполнить подмену [i]utilman.exe[/i]
[list]
Файл целевой Windows [i]%SystemRoot%\System32\Utilman.exe[/i] будет заменён на [i]cmd.exe[/i] (а исходный файл переименован в [i]utilman.exe.bak[/i]). На этапе входа в систему (окно со списком аккаунтов и ввода пароля) нажать сочетание клавиш [b]Win+U[/b]. Откроется консольное окно, где можно вводить команды ОС или запустить с флешки любимое приложение.
[/list]
[br]
[*]Выполнить подмену [i]sethc.exe[/i]
[list]
Файл целевой Windows [i]%SystemRoot%\System32\sethc.exe[/i] будет заменён на [i]cmd.exe[/i] (а исходный файл переименован в [i]sethc.exe.bak[/i]). На этапе входа в систему (окно со списком аккаунтов и ввода пароля) нажать клавишу [b]Shift[/b] пять раз. Откроется консольное окно, где можно вводить команды ОС или запустить с флешки любимое приложение.
[/list]
[br]
[*]Отменить подмену [i]utilman.exe/sethc.exe[/i]
[list]
Если выполнена подмена хотя бы одного из файлов [i]utilman.exe/sethc.exe[/i], то появится этот пункт меню, позволяющий отменить сделанную подмену (соответствующие *.bak-файлы будут переименованы в исходные).
[/list]
[/list]
[br]
[spoiler=*** Важно! ***]
[color=red][b]Важно![/b][/color] Если компьютер вошёл в "круговую перезагрузку", выполнить следующее: загрузиться в WinPE, выполнить бат-ник, выбрать пункт "Установить обработчик паролей" и затем выбрать "Удалить и выйти" (см. второй [i]screenshot[/i]).
[br]
[color=red][b]Важно![/b][/color] Во избежание "эффекта FastBoot" (ошибка "Реестр заблокирован!", диск целевой Windows монтируется не как С:, а другим диском) применять следующий порядок загрузки: загрузиться в целевую Windows, затем выполнить перезагрузку и загрузить WinPE (не грузить сразу WinPE из состояния выключенного ПК).
[br]
[color=red][b]Важно![/b][/color] Убедитесь, что целевая Windows не находится в процессе установки обновлений (при перезагрузке не должно быть сообщений об установке). В противном случае, произведите необходимое количество перезагрузок целевой Windows до полного завершения установки обновлений.
[/spoiler]
[spoiler=Screenshots][align=center]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/01.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/02.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/03.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/04.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/05.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/06.gif[/th]
[th]https://github.com/Ander73/Store/raw/master/ChangePassword/img/07.gif[/th]
[/align][/spoiler]
[spoiler=Для продвинутых пользователей]
[list][*]если в строке ввода номера пользователя ввести [b]cmd[/b], то откроется доп.консоль, куда можно вводить команды ОС (или, например, запустить с флешки любимое приложение).
[*]если в строке ввода номера пользователя ввести [b]uman[/b], то будет произведена подмена файла [i]%SystemRoot%\System32\Utilman.exe[/i] на [i]cmd.exe[/i] (а [i]utilman.exe[/i] будет переименован в [i]utilman.exe.bak[/i]).
[*]если в строке ввода номера пользователя ввести [b]sethc[/b], то будет произведена подмена файла [i]%SystemRoot%\System32\sethc.exe[/i] на [i]cmd.exe[/i] (а [i]sethc.exe[/i] будет переименован в [i]sethc.exe.bak[/i]).
[/list]
[/spoiler]
[spoiler=Дополнительная информация]
[list][*]Работает на всей линейке Windows:  XP/7/8.1/10 и любой разрядности: x86/x64
[*]Проверена работоспособность на русской, английской, французской, польской Windows.
[*]Интерфейс программы переведён на два языка: русский и английский. Русский язык выбирается при работе в русской Windows. Во всех остальных случаях интерфейс будет по-английски.
Желающие добавить переводы на другие языки - милости просим![/spoiler]
[spoiler=ЧаВо]
[list][*][b]В:[/b] Как "сбросить пароль", чтобы входить в систему без ввода пароля?
[*][b]О:[/b] При вводе пароля просто нажать Enter (и затем ещё раз, при подтверждении).[/list]
[hr]
[list][*][b]В:[/b] Почему нет опции "сброса пароля"? Почему такой сложный пароль у создаваемого локального Администратора?
[*][b]О:[/b] На целевой Windows может быть настроена [url=https://technet.microsoft.com/ru-ru/library/mt634223%28v=vs.85%29.aspx]Политика паролей[/url], которая может требовать, чтобы пароль состоял, как минимум, из больших и маленьких букв, и цифр (более подробно см. по ссылке пункт требований к сложности пароля).[/list]
[hr]
[list][*][b]В:[/b] Как сменить пароль учётной записи пользователя домена?
[*][b]О:[/b] Никак. Сменить пароль можно только у локальной учётной записи (см. ниже рекомендации для «Учётной записи Microsoft»).[/list]
[hr]
[list][*]Если целевая Windows настроена на использование «Учётной записи Microsoft»:
[list=1][*]Активировать локального Администратора или создать его автоматически;
[*]Сменить/сбросить, если необходимо, пароль активированного/созданного локального Администратора;
[*]Деактивировать, если необходимо, учётную запись Microsoft (userw в русской Windows);
[*]Войти в систему под активированным/созданным локальным Администратором.[/list][/list]
[hr]
[list][*][b]В:[/b] Будет ли работать бат-ник в установленной системе, а не WinPE? Как работать с Windows, установленной в VHD?
[*][b]О:[/b] В установленной системе бат-ник работать будет, но необходимо запускать его от имени Администратора. Для работы с Windows, установленной в VHD, необходимо смонтировать VHD как локальный диск в оснастке «Управление дисками» (diskmgmt.msc) с разрешением записи и затем запустить бат-ник от имени Администратора.
[/list]
[/spoiler]
[spoiler=Благодарность]
[b]Joker-2013[/b], как инициатору проекта и активному участнику
[b]korsak7, nikzzzz[/b], за тестирование и дельные советы
[/spoiler]
[align=center][url=https://github.com/Ander73/Store/raw/master/ChangePassword/chpwd.7z]Загрузить Change Password [img]https://github.com/Ander73/Store/raw/master/download.png[/img][/url][/align]